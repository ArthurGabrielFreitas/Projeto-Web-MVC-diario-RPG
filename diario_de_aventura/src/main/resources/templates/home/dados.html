<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Importação de Dados')}" />
<body>
<header th:replace="~{fragments/header :: header}"></header>
<div th:replace="~{fragments/messages :: messages}"></div>

    <style th:inline="text">
        /* CSS simplificado para o relatório */
        /* Forçar cor de destaque para os títulos de seção */
        .report-card h6 {
            color: #0d6efd !important; /* azul primário com bom contraste */
            font-weight: 800 !important;
            font-size: 1.1rem !important;
            margin-bottom: .75rem !important;
        }

        .report-card .list-group-item {
            font-size: 1.15rem;
            padding: 1rem 1.25rem;
        }

        .report-card .badge {
            font-size: 1rem;
            padding: .5rem .7rem;
        }

        /* Fazer o relatório ocupar mais espaço horizontal em telas grandes */
        @media (min-width: 992px) {
            .report-card { min-height: 320px; }
        }
    </style>
</head>
<body>
    <div th:fragment="conteudo">
        <section id="dados" class="container py-5">
            <div class="row mb-3">
                <div class="col">
                    <h1 class="titulo-principal">
                        <i class="bi bi-file-earmark-text me-2"></i>Relatório — Personagens, Ameaças e Encontros
                    </h1>
                    <p class="lead">Resumo analítico com contagens sobre personagens, ameaças e participações em encontros.</p>
                </div>
            </div>

            <!-- Report: layout em duas colunas maiores -->
            <div class="row" th:if="${relatorio != null}">
                <div class="col-lg-5 mb-3">
                    <div class="card report-card">
                        <div class="card-body">
                            <h6>Top Raças</h6>
                            <ul class="list-group mb-3">
                                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="it : ${relatorio.topRacas}">
                                    <span th:text="${it.label}">Humano</span>
                                    <span class="badge bg-primary" th:text="${it.count}">0</span>
                                </li>
                            </ul>

                            <h6>Top Classes</h6>
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="it : ${relatorio.topClasses}">
                                    <span th:text="${it.label}">Guerreiro</span>
                                    <span class="badge bg-primary" th:text="${it.count}">0</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-lg-7 mb-3">
                    <div class="card report-card">
                        <div class="card-body">
                            <h6>Personagens mais ativos</h6>
                            <ul class="list-group mb-3">
                                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="p : ${relatorio.topParticipantes}">
                                    <span th:text="${p.nome}">Nome</span>
                                    <span class="badge bg-primary" th:text="${p.count}">0</span>
                                </li>
                            </ul>

                            <h6>Ameaças mais presentes</h6>
                            <ul class="list-group mb-3">
                                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="a : ${relatorio.topAmeacasParticipacoes}">
                                    <span th:text="${a.nome}">Ameaça</span>
                                    <span class="badge bg-primary" th:text="${a.count}">0</span>
                                </li>
                            </ul>

                            <h6>Últimos golpes (Top)</h6>
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center" th:each="u : ${relatorio.topUltimoGolpe}">
                                    <div>
                                        <small class="text-muted" th:text="${u.tipo == 'personagem' ? 'Personagem' : 'Ameaça'}">Tipo</small>
                                        <div th:text="${u.nome}">Nome</div>
                                    </div>
                                    <span class="badge bg-primary" th:text="${u.count}">0</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </div>

        <footer th:replace="~{fragments/footer :: footer}"></footer>

        <div th:fragment="scriptsAdicionais">
        <script th:inline="javascript">
            /*<![CDATA[*/
            document.addEventListener('DOMContentLoaded', function() {
                const dropzone = document.getElementById('dropzone');
                const fileInput = document.getElementById('arquivoInput');
                
                // Clique na dropzone
                dropzone.addEventListener('click', () => fileInput.click());
                
                // Arrastar e soltar
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.classList.add('dragover');
                });
                
                dropzone.addEventListener('dragleave', () => {
                    dropzone.classList.remove('dragover');
                });
                
                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropzone.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length) {
                        fileInput.files = e.dataTransfer.files;
                        
                        // Mostrar nome do arquivo
                        const fileName = e.dataTransfer.files[0].name;
                        dropzone.innerHTML = `
                            <i class="bi bi-file-earmark-check display-4 text-warning mb-3"></i>
                            <h4>Arquivo pronto</h4>
                            <p class="text-truncate">${fileName}</p>
                            <div class="mt-3">
                                <span class="badge bg-danger">Clique para alterar</span>
                            </div>
                        `;
                    }
                });
                
                // Alteração do input de arquivo
                fileInput.addEventListener('change', function() {
                    if (this.files.length) {
                        const fileName = this.files[0].name;
                        dropzone.innerHTML = `
                            <i class="bi bi-file-earmark-check display-4 text-warning mb-3"></i>
                            <h4>Arquivo selecionado</h4>
                            <p class="text-truncate">${fileName}</p>
                            <div class="mt-3">
                                <span class="badge bg-danger">Clique para alterar</span>
                            </div>
                        `;
                    }
                });
                
                // Validação do formulário de conexão
                const conexaoForm = document.getElementById('conexaoForm');
                conexaoForm.addEventListener('submit', function(e) {
                    const tipoBanco = document.getElementById('tipoBanco').value;
                    if (!tipoBanco) {
                        e.preventDefault();
                        alert('Selecione o tipo de banco de dados');
                    }
                });
            });
            /*]]>*/
        </script>
    </div>
</body>
</html>