<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${titulo} ?: 'Projeto • Tormenta20'">Projeto • Tormenta20</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" th:content="${descricao} ?: 'Dashboard Analítico para Tormenta20'"/>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- CSS Personalizado -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
    
    <!-- CSS específico da página -->
    <th:block th:replace="${cssAdicional} ?: _"></th:block>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/}">
                <i class="bi bi-dice-6-fill me-2"></i>Tormenta20
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarPrincipal">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarPrincipal">
                <!-- Menu Principal -->
                <ul class="navbar-nav me-auto">
                    <li class="nav-item" th:classappend="${paginaAtiva == 'inicio'} ? 'active'">
                        <a class="nav-link" th:href="@{/}">
                            <i class="bi bi-house-door"></i> Início
                        </a>
                    </li>
                    
                    <!-- Dropdown Ameaças -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'ameacas'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-shield-exclamation"></i> Ameaças
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/ameaca/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Ameaças
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/ameaca/nova}">
                                <i class="bi bi-plus-circle"></i> Nova Ameaça
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/ameaca/busca}">
                                <i class="bi bi-search"></i> Buscar Ameaças
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Encontros -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'encontros'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-swords"></i> Encontros
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/encontro/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Encontros
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/encontro/novo}">
                                <i class="bi bi-plus-circle"></i> Novo Encontro
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/encontro/planejador}">
                                <i class="bi bi-diagram-3"></i> Planejador
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Fragmentos -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'fragmentos'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-puzzle"></i> Fragmentos
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/fragmento/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Fragmentos
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/fragmento/novo}">
                                <i class="bi bi-plus-circle"></i> Novo Fragmento
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/fragmento/categorias}">
                                <i class="bi bi-tags"></i> Categorias
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Magias -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'magias'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-stars"></i> Magias
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/magia/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Magias
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/magia/nova}">
                                <i class="bi bi-plus-circle"></i> Nova Magia
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/magia/escolas}">
                                <i class="bi bi-mortarboard"></i> Escolas
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/magia/circulos}">
                                <i class="bi bi-circle"></i> Círculos
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Personagens -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'personagens'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-badge"></i> Personagens
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/personagem/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Personagens
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/personagem/novo}">
                                <i class="bi bi-plus-circle"></i> Novo Personagem
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/personagem/npcs}">
                                <i class="bi bi-people"></i> NPCs
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/personagem/jogadores}">
                                <i class="bi bi-controller"></i> Jogadores
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Poderes -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'poderes'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-lightning-charge"></i> Poderes
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/poder/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Poderes
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/poder/novo}">
                                <i class="bi bi-plus-circle"></i> Novo Poder
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/poder/raças}">
                                <i class="bi bi-person-arms-up"></i> Poderes de Raça
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/poder/classe}">
                                <i class="bi bi-person-gear"></i> Poderes de Classe
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/poder/geral}">
                                <i class="bi bi-person-square"></i> Poderes Gerais
                            </a></li>
                        </ul>
                    </li>
                    
                    <!-- Dropdown Sessões -->
                    <li class="nav-item dropdown" th:classappend="${paginaAtiva == 'sessoes'} ? 'active'">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-calendar-event"></i> Sessões
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" th:href="@{/sessao/lista}">
                                <i class="bi bi-list-ul"></i> Lista de Sessões
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/sessao/nova}">
                                <i class="bi bi-plus-circle"></i> Nova Sessão
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/sessao/agenda}">
                                <i class="bi bi-calendar-week"></i> Agenda
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/sessao/campanha}">
                                <i class="bi bi-map"></i> Por Campanha
                            </a></li>
                        </ul>
                    </li>
                </ul>
                
                <!-- Barra de Busca e Utilitários -->
                <div class="d-flex align-items-center">
                    <!-- Barra de Busca -->
                    <form class="d-flex me-3" th:action="@{/busca}" method="get">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control form-control-t20" placeholder="Buscar..." name="q">
                            <button class="btn btn-t20" type="submit">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </form>
                    
                    <!-- Usuário/Configurações -->
                    <div class="navbar-nav">
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle"></i>
                                <span th:if="${usuario != null}" th:text="${usuario.nome}">Usuário</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                                <li><a class="dropdown-item" th:href="@{/config}">
                                    <i class="bi bi-gear"></i> Configurações
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" th:href="@{/logout}">
                                    <i class="bi bi-box-arrow-right"></i> Sair
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="container-fluid pt-5 mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mt-3" th:if="${breadcrumb != null}">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Início</a></li>
                <th:block th:each="item : ${breadcrumb}">
                    <li class="breadcrumb-item" 
                        th:classappend="${itemStat.last} ? 'active'" 
                        th:if="${!itemStat.last}">
                        <a th:href="${item.url}" th:text="${item.nome}"></a>
                    </li>
                    <li class="breadcrumb-item active" th:unless="${!itemStat.last}" 
                        th:text="${item.nome}" aria-current="page"></li>
                </th:block>
            </ol>
        </nav>
        
        <!-- Mensagens Flash -->
        <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show mx-3" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            <span th:text="${mensagemSucesso}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${mensagemErro}" class="alert alert-danger alert-dismissible fade show mx-3" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <span th:text="${mensagemErro}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- Área de conteúdo -->
        <div th:replace="${conteudo} ?: ~{::conteudo}">
            <!-- Conteúdo padrão (será substituído) -->
            <section id="inicio" class="container py-5">
                <h1 class="titulo-principal">Dashboard Tormenta20</h1>
                <p class="lead mt-3">Sistema de gerenciamento para campanhas de <strong class="text-t20-gold">Tormenta20</strong>.</p>
            </section>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer mt-auto py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <span class="text-muted">© 2025 • Sistema Tormenta20 • v<span th:text="${versao} ?: '1.0.0'">1.0.0</span></span>
                </div>
                <div class="col-md-6 text-md-end">
                    <span class="text-muted">
                        <i class="bi bi-clock-history me-1"></i>
                        <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts personalizados -->
    <script th:src="@{/js/scripts.js}"></script>
    
    <!-- Scripts específicos da página -->
    <th:block th:replace="${scriptsAdicionais} ?: _"></th:block>
</body>
</html>